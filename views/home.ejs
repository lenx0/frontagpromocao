<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <title>AGLabs</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link href="../css/styles.css" rel="preload" as="style">


    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <link rel="stylesheet" href="../css/styles.css">
    <script>
        const _tableList =
            "<table class='table'>" +
            "    <thead>" +
            "        <tr>" +
            "            <th scope='col'>Titulo</th>" +
            "            <th scope='col'>Tipo</th>" +
            "            <th scope='col'>Status</th>" +
            "            <th scope='col'>Data Inicial</th>" +
            "            <th scope='col'>Data Final</th>" +
            "        </tr>" +
            "    </thead>" +
            "    <tbody>" +
            "{items}" +
            "    </tbody>" +
            "</table>";

        const _tableItem =
            "<tr>" +
            "    <td scope='row'>{title}</td>" +
            "    <td>{type}</td>" +
            "    <td>{status}</td>" +
            "    <td>{dateStart}</td>" +
            "    <td>{dateEnd}</td>" +
            "</tr>";

    </script>
    <script>
        const url_base = 'http://localhost:3001/v1/campaign';
        function listar() {
            fetch(`${url_base}/`)
                .then(response => response.json())
                .then(result => {
                    carregarLista(result);
                })
        }

        function buscar() {
            const titleInput = document.getElementById('inputTitle').value
            fetch(`${url_base}/find/${titleInput}`)
                .then(response => response.json())
                .then(result => {
                    carregarLista(result);
                })
        }



        function fazGet(url) {
            let request = new XMLHttpRequest()
            request.open("GET", url, false)
            request.send()
            return request.responseText
        }


        function fazPost(url, body) {
            console.log("body=", body)
            let request = new XMLHttpRequest()
            request.open("POST", url, true)
            request.setRequestHeader("Content-type", "application/json")
            request.send(JSON.stringify(body))
            request.onload = function () {
                console.log(this.responseText)
            }

            return request.responseText
        }

        function cadastraEvento() {
            event.preventDefault()
            let url = "http://localhost:3001/v1/campaign/"
            let title = document.getElementById("inputTitle").value
            let type = document.getElementById("inputType").value
            let status = document.getElementById("inputStatus").value
            let dateStart = document.getElementById("inputdateStart").value
            let dateEnd = document.getElementById("inputdateEnd").value
            let pageHtml = document.getElementById("inputpageHtml").value
            let emailToSend = document.getElementById("emailToSend").value
            let host = document.getElementById("inputHost").value
            let port = document.getElementById("inputPort").value
            let name = document.getElementById("inputName").value
            let email = document.getElementById("inputEmail").value
            let user = document.getElementById("inputUser").value
            let pass = document.getElementById("inputPass").value


            console.log(title)

            body = {
                "title": title,
                "type": type,
                "status": status,
                "date_start": dateStart,
                "date_end": dateEnd,
                "pageHtml": pageHtml,
                "emailToSend": emailToSend,
                "smtp": {
                    "host": host,
                    "port": port,
                    "name": name,
                    "email": email,
                    "user": user,
                    "pass": pass
                }

            }

            fazPost(url, body)
        }

        function carregarLista(request) {
            var conteudoItems = "";
            console.log(request)
            if (request.campaign)
                request.campaign.map(item => {

                    var tableItem = _tableItem
                        .replace("{title}", item.title)
                        .replace("{type}", item.type)
                        .replace("{status}", item.status)
                        .replace("{dateStart}", item.date_start)
                        .replace("{dateEnd}", item.date_end);

                    conteudoItems += tableItem;
                });
            var tableList = _tableList
                .replace("{items}", conteudoItems);

            var listaItem = document.getElementById("listaItem");

            listaItem.innerHTML = tableList;
        }
    </script>
</head>

<body class="container">
    <link href="../css/styles.css" rel="preload" as="style">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
    <header>
    </header>
    <main>
        <div>
            <h6 class="descricao">projeto desenvolvido por aglabs</h6>
        </div>
        <div class="jumbotron row-sm-1" align="center">
            <h1>CAMPANHA ALTO GIRO</h1>
        </div>

        <form>
            <div class="form-group">
                <label>Título</label>
                <input type="title" class="form-control" id="inputTitle" placeholder="Insira o título">
            </div>
            <div class="form-row">
                <div class="form-group col-md-2">
                    <label>Tipo</label>
                    <select id="inputType" class="form-control">
                        <option selected="">Escolher...</option>
                        <option>Campanha</option>
                        <option>Promoção</option>
                    </select>
                </div>
                <div class="form-group col-md-2">
                    <label>Status</label>
                    <select id="inputStatus" class="form-control">
                        <option selected="">Escolher...</option>
                        <option>Ativo</option>
                        <option>Inativo</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>Início</label><br>
                <input id="inputdateStart" type="datetime-local">
            </div>
            <div class="form-group">
                <label>Termino</label><br>
                <input id="inputdateEnd" type="datetime-local">
            </div>
            <div class="form-row">
                <div class="form-group col-md-5">
                    <label>Host</label>
                    <input type="title" class="form-control" id="inputHost" placeholder="smtp.office365.com">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-md-2">
                    <label>Porta</label>
                    <input type="text" class="form-control" id="inputPort" placeholder="Insira a porta">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-md-5">
                    <label>Nome</label>
                    <input type="text" class="form-control" id="inputName" placeholder="Insira o nome">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-md-5">
                    <label>Email</label>
                    <input type="email" class="form-control" id="inputEmail" placeholder="email@example.com">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-md-5">
                    <label>Usuário</label>
                    <input type="text" class="form-control" id="inputUser" placeholder="user@example.com">
                </div>
            </div>
            <div class="form-row">
                <div class="form-group col-md-5">
                    <label>Senha</label>
                    <input type="text" class="form-control" id="inputPass" placeholder="Senha">
                </div>
            </div>
        </form>
        <div class="form-group">
            <button onclick="window.location.reload()" type="reset" class="btn btn-primary">Limpar</button>
            <button onclick="buscar()" type="submit" class="btn btn-primary">Buscar</button>
            <button onclick="cadastraEvento(),submitSucessAlert()" type="submit" class="btn btn-primary">Salvar</button>

            <button onclick="listar()" type="submit" class="btn btn-primary">Listar</button>
            <button type="submit" class="btn btn-primary">Excluir</button>
        </div>
        <div class="form-group">
            <label>Conteúdo da página</label><br>
            <textarea id="inputpageHtml" name="inputpageHtml" rows="5" cols="38">
        </textarea>
        </div>
        <div class="form-group">
            <label>Lista de Emails</label><br>
            <textarea id="emailToSend" name="emailToSend" rows="5" cols="38">
        </textarea>
        </div>
        <div id="listaItem">
        </div>
    </main>
    <script>
        listar()
        function submitSucessAlert() {
            alert("Sucess!!!")
        }
    </script>
</body>

</html>